<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>@swimorthink Cart</title>
<link rel="stylesheet" href="style.css" />
<style>
  .cart-container {
    width: 90%;
    max-width: 800px;
    margin: 2rem auto;
    text-align: center;
  }

  .cart-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #fff;
    margin-bottom: 1rem;
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    flex-wrap: wrap;
  }

  .cart-item img {
    width: 80px;
    height: 80px;
    object-fit: contain;
  }

  .cart-item-details {
    flex: 1;
    margin-left: 1rem;
    text-align: left;
    min-width: 150px;
  }

  .cart-item-details p {
    margin: 0.25rem 0;
  }

  .remove-btn {
    background: #ff5555;
    color: #fff;
    border: none;
    padding: 0.3rem 0.6rem;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 0.5rem;
  }

  .remove-btn:hover {
    background: #ff2222;
  }

  .cart-total {
    text-align: right;
    font-size: 1.5rem;
    font-weight: bold;
    margin-top: 1rem;
  }

  #startCheckoutBtn {
    display: block;
    margin: 1.5rem auto; 
    padding: 0.8rem 1.5rem;
    font-size: 1.2rem;
    background: #6772e5;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  #startCheckoutBtn:hover {
    background: #5469d4;
  }

  /* Quantity input styling */
  .quantity-input {
    width: 50px;
    padding: 3px 5px;
    margin-left: 5px;
    border-radius: 5px;
    border: 1px solid #ccc;
    text-align: center;
  }

  @media (max-width: 480px) {
    .cart-item {
      flex-direction: column;
      align-items: flex-start;
    }
    .cart-item-details {
      margin-left: 0;
      margin-top: 0.5rem;
    }
    #startCheckoutBtn {
      width: 90%;
      font-size: 1rem;
    }
  }
</style>
</head>
<body>
<header>
  <a href="index.html">
    <img src="assets/logo.gif" alt="@swimorthink logo" class="logo" />
  </a>
  <div class="header-banner" id="account-banner">
    <a href="index.html" id="account-link">Home</a>
  </div>
  <div class="header-banner2" id="account-banner">
    <a href="login.html" id="account-link">Login</a>
  </div>
    
</header>

<main>
  <div class="cart-container" id="cartContainer">
    <h1></h1>
    <div id="cartItems"></div>
    <div class="cart-total" id="cartTotal">Total: $0</div>
    <button id="startCheckoutBtn">Checkout & Pay</button>
  </div>
</main>

<footer>
  <p>Â© <span id="year"></span>. All Rights Reserved.</p>
</footer>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

const isLoggedIn = localStorage.getItem("loggedIn") === "true";
const accountLink = document.getElementById("account-link");
if (isLoggedIn) { 
  accountLink.textContent = "My Account"; 
  accountLink.href = "account.html"; 
}

let cart = JSON.parse(localStorage.getItem("cart")) || [];

function renderCart() {
  const cartItemsContainer = document.getElementById("cartItems");
  const cartTotalEl = document.getElementById("cartTotal");
  const checkoutBtn = document.getElementById("startCheckoutBtn");

  cartItemsContainer.innerHTML = "";
  let total = 0;

  // If cart is empty
  if (cart.length === 0) {
    cartItemsContainer.innerHTML = `
      <p style="font-size: 1.2rem; color: #555; margin-top: 1rem;">
        Your cart is empty ðŸ›’
      </p>
    `;
    cartTotalEl.style.display = "none";
    checkoutBtn.style.display = "none";
    return;
  }

  cartTotalEl.style.display = "block";
  checkoutBtn.style.display = "inline-block";

  cart.forEach((item, index) => {
    if (!item.quantity) item.quantity = 1;
    total += item.price * item.quantity;

    const cartItem = document.createElement("div");
    cartItem.className = "cart-item";

    cartItem.innerHTML = `
      <img src="${item.image}" alt="${item.name}" />
      <div class="cart-item-details">
        <p><strong>${item.name}</strong></p>
        <p>Color: ${item.color || 'Default'}</p>
        <p>Size: ${item.size || 'M'}</p>
        <p>Price: $${item.price}</p>
        <label>
          Quantity: 
          <input type="number" min="1" value="${item.quantity}" data-index="${index}" class="quantity-input" />
        </label>
      </div>
      <button class="remove-btn" onclick="removeItem(${index})">Remove</button>
    `;

    cartItemsContainer.appendChild(cartItem);
  });

  document.getElementById("cartTotal").textContent = `Total: $${total}`;

  // Listen for quantity changes
  document.querySelectorAll(".quantity-input").forEach(input => {
    input.addEventListener("change", (e) => {
      const idx = e.target.dataset.index;
      let val = parseInt(e.target.value);
      if (isNaN(val) || val < 1) val = 1;
      cart[idx].quantity = val;
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    });
  });
}

function removeItem(index) {
  cart.splice(index, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

renderCart();

// Stripe Checkout
const stripe = Stripe("YOUR_PUBLISHABLE_KEY"); // Replace with your key

document.getElementById("startCheckoutBtn").addEventListener("click", async () => {
  if (cart.length === 0) {
    alert("Your cart is empty!");
    return;
  }

  const response = await fetch("/create-checkout-session", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ items: cart })
  });

  const data = await response.json();

  if (data.error) {
    alert("Checkout error: " + data.error);
    return;
  }

  const result = await stripe.redirectToCheckout({ sessionId: data.sessionId });

  if (result.error) {
    alert(result.error.message);
  }
});
</script>

</body>
</html>
